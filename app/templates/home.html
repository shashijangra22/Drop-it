{% extends "base.html" %}
{% block css %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename="homePage.css") }}">
{% endblock %}
{% block content %}
<header>
	<div class="navbar-fixed">
		<nav class="blue">
		    <div class="nav-wrapper">
		      <a href="{{url_for('home')}}" class="brand-logo">Drop it!</a>
		      <a href="#" data-target="mobile-demo" class="sidenav-trigger"><i class="material-icons">menu</i></a>
		      <ul class="right hide-on-med-and-down">
		        <li><a href="{{ url_for('logout') }}">Logout</a></li>
		      </ul>
		    </div>
		  </nav>
	</div>

	<ul class="sidenav sidenav-fixed" id="mobile-demo">
	    <li class="active"><a href="{{ url_for('home') }}"><i style="margin: 0px" class="fas fa-cloud"></i> My Files</a></li>
	    <li><a href="{{ url_for('home') }}"><i style="margin: 0px" class="fas fa-users"></i>Shared With Me</a></li>
	    <li><a href="{{ url_for('home') }}"><i style="margin: 0px" class="fas fa-user"></i>My Profile</a></li>
	    <li><a href="{{ url_for('logout') }}"><i style="margin: 0px" class="fas fa-sign-out-alt"></i>Logout</a></li>
	</ul>
</header>
<main>
	<div style="margin: 10px">
		<!-- <nav class="blue">
		    <div class="nav-wrapper">
		      <div class="col s12" style="margin-left: 20px">
		        <a href="#!" class="breadcrumb" style="color: white">Home</a>
		      </div>
		    </div>
		  </nav>
		  <br> -->
		<nav class="blue">
		<div class="nav-wrapper" style="margin-bottom: 0px;">
	        <!-- <form> -->
		        <div class="input-field">
		          <input id="search" type="search" placeholder="search for files...">
		          <label class="label-icon" for="search"><i class="material-icons">search</i></label>
		          <i class="material-icons">close</i>
		        </div>
		      <!-- </form> -->
	      </div>
	  </nav>
		<div class="row">
			<div class="col s12">
				<h5>Folders</h5>
				<table>
			        <thead>
			          <tr>
			              <th>Name</th>
			              <th>Owner</th>
			              <th>URL</th>
			              <th>Actions</th>
			          </tr>
			        </thead>
			        <tbody>
			        	{% for item in myFiles %}
			        		{% if item.isFile %}
			        		{% else %}
			        			<tr id="{{ item.id }}" class="filePost">
						            <td><a class="openFileBtn" href="{{ item.url }}/{{ item.filename }}"><i class="fas fa-folder" style="font-size: 32px"></i> {{ item.filename }}</a></td>
						            <td>{{item.owner.username}}</td>
						            <td>{{item.url}}</td>
						            <td><a class='dropdown-trigger' href='#' data-target='dropdown1'><i class="material-icons">more</i></a></td>
						          </tr>
			        		{% endif %}
			        	{% endfor %}
			        </tbody>
		      </table>
			</div>
		</div>
		<div class="row">
			<div class="col s12">
				<h5>Files</h5>
				<table>
			        <thead>
			          <tr>
			              <th>Name</th>
			              <th>Owner</th>
			              <th>URL</th>
			              <th>Actions</th>
			          </tr>
			        </thead>
			        <tbody>
			        	{% for item in myFiles %}
			        		{%  if item.isFile %}
			        			<tr id="{{ item.id }}" class="filePost">
						            <td><a class="openFileBtn" href="{{ item.url }}/{{ item.filename }}"><i style="font-size: 32px" class="fas fa-file"></i> {{ item.filename }}</a></td>
						            <td>{{item.owner.username}}</td>
						            <td>{{item.url}}</td>
						            <td><a class='dropdown-trigger' href='#' data-target='dropdown1'><i class="material-icons">more</i></a></td>
						          </tr>
			        		{% endif %}
			        	{% endfor %}
			       	</tbody>
			     </table>		
			</div>
		</div>
	</div>

	  <!-- Dropdown Structure -->
	  <ul id='dropdown1' class='dropdown-content'>
	    <li><a href="#!">Delete</a></li>
	    <li><a href="#!">View</a></li>
	    <li><a href="#!">Downlaod</a></li>
	    <li><a href="#!">Share</a></li>
	  </ul>
	<div class="fixed-action-btn">
	  <a class="btn-floating btn-large red">
	    <i class="large material-icons">mode_edit</i>
	  </a>
	  <ul>
	    <li><a class="btn-floating red modal-trigger" href="#folderModal"><i class="material-icons">create_new_folder</i></a></li>
	    <li><a class="btn-floating blue modal-trigger" href="#filesModal"><i class="material-icons">cloud_upload</i></a></li>
	  </ul>
	</div>
	  <!-- <a style="position: fixed;right: 0px;bottom: 0px;margin: 15px" class="btn-floating btn-large waves-effect waves-light blue modal-trigger" href="#uploadModal"><i class="material-icons">add</i></a> -->
   <!-- Modal Structure -->
	  <div id="filesModal" class="modal">
	    <div class="modal-content"  style="padding: 15px">
	      <form id="uploadForm" enctype="multipart/form-data">
		    <div class="file-field input-field" style="margin-bottom: 0px; margin-top: 0px">
		      <div class="btn">
		        <span>Files</span>
		        <input type="file" name="inputFiles" multiple>
		      </div>
		      <div class="file-path-wrapper">
		        <input class="file-path validate" type="text" placeholder="Upload one or more files">
		      </div>
		    </div>
		  </form>
	    </div>
	    <div class="modal-footer">
	      <a class="waves-effect btn" id="uploadBtn">Upload</a>
	    </div>
	  </div>
	  <div id="folderModal" class="modal">
	    <div class="modal-content" style="padding: 15px" >
	      <div class="row" style="margin:0px">
	        <div class="input-field col s12" style="margin-bottom: 0px; margin-top: 0px">
	          <input type="text" id="folderName" name="folderName">
	          <label for="folderName">Folder Name</label>
	        </div>
	      </div>
	    </div>
	    <div class="modal-footer">
	      <a class="waves-effect btn" id="newFolderBtn">Create New Folder</a>
	    </div>
	  </div>
</main>
{% endblock %}
{% block scripts %}
<script type="text/javascript">

	$(document).ready(function(){
	    $('.sidenav').sidenav();
	    $('.modal').modal();
	 	$('.fixed-action-btn').floatingActionButton();
	 	$('.dropdown-trigger').dropdown();
	  });

		var el=$('main');
		delBtn=el.find('.delBtn');
		shareBtn=el.find('.shareBtn');
		uploadBtn=el.find('#uploadBtn');
		newFolderBtn=el.find('#newFolderBtn');
		
		delBtn.on('click',deleteFile);
		shareBtn.on('click',shareFile);
		uploadBtn.on('click',uploadFile);
		newFolderBtn.on('click',uploadFile);

		function uploadFile() {
			var form = $('form')[0];
			var formData=new FormData(form);
			formData.append('url', window.location.pathname);
			formData.append('folderName', $('#folderName').val());
			$.ajax({
				url:'/upload',
				data:formData,
				type:'POST',
				contentType:false,
				processData:false,
				success:function (result) {
					if(result=="1"){
						M.toast({html: "Succesfully Added !", displayLength:3000});
						window.location.href=window.location.pathname;
					}
					else{
						M.toast({html: result, displayLength:5000});
					}
				}
			});
		}

		function shareFile(event) {
			$div=$(this).parent();
			fileID=$div.attr('id');
			username=$div.find('input').val();
			$.ajax({
				url:"/share",
				method:'POST',
				data:{username:username, fileID:fileID},
				success:function (result) {
					console.log(result);
					if(result=="3"){
						window.location.href=window.location.pathname;
					}
				}
			});
		}

		function deleteFile(event) {
			$div=$(this).closest('tr');
			fileID=$div.attr('id');
			$.ajax({
				url:"/deleteFile/"+fileID,
				success: function (result) {
					if(result.length){
						console.log(result);
						$div.fadeOut();
						window.location.href=window.location.pathname;
					}
				}
			});
		}
	</script>
{% endblock %}